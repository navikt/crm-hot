<template>
    <div class="brodsmulesti">
        <lightning-breadcrumbs class="skjema-max-width">
            <lightning-breadcrumb label="Tolketjenesten" href="/s/"> </lightning-breadcrumb>
            <lightning-breadcrumb label="Ny bestilling" href="/s/ny-bestilling"> </lightning-breadcrumb>
        </lightning-breadcrumbs>
    </div>

    <div class="main-content submitted-false">
        <div class="skjema-ikon tolketjenesten">
            <img class="skjema-ikon-img" src="/s/sfsites/c/resource/1585817547000/SkjemaIkon" alt="" />
        </div>
        <div class="skjema skjema-max-width">
            <lightning-record-edit-form
                object-api-name="HOT_Request__c"
                density="comfy"
                onsuccess={handleSuccess}
                onerror={handleError}
                onsubmit={handleSubmit}
                record-id={recordId}
            >
                <section if:true={showNextButton} class="valg-av-bestillingstype__container sub-form">
                    <lightning-radio-group
                        name="radioGroup"
                        class="requestTypeChoice"
                        style="margin-bottom: 1rem"
                        label="Hvilken type bestilling ønsker du?"
                        options={requestTypes}
                        type="radio"
                        onchange={handleRequestTypeChange}
                        value={currentRequestType}
                    >
                    </lightning-radio-group>

                    <div
                        if:true={publicEventForm}
                        class="offentlig-arrangement-info-skjema"
                        style="margin-bottom: 1rem"
                    >
                        <lightning-combobox
                            class="type-arrangement"
                            name="typeOfEvent"
                            label="Type arrangement"
                            options={eventTypes}
                            onchange={handleChoiceOfEvent}
                            required
                        >
                        </lightning-combobox>
                    </div>

                    <lightning-messages aria-live="assertive"> </lightning-messages>
                    <lightning-button if:true={showNextButton} variant="brand" onclick={onHandleNeste} label="Neste">
                    </lightning-button>
                </section>

                <div if:false={showNextButton} class="actual-form">
                    <section if:true={ordererForm} class="bestiller-info-skjema sub-form">
                        <p if:true={showInformationSharingText} class="typo-normal">
                            Navn på bestiller/virksomhet (ikke kontaktinformasjon) og bestillingens øvrige informasjon
                            om behov for tolk, vil være tilgjengelig for tolkebruker
                        </p>
                        <h2 style="font-size: 1.25rem">
                            Kontaktinformasjon
                            <lightning-helptext
                                content="For å kunne kontakte deg ved behov for ytterligere opplysninger, vil dine kontaktopplysninger bli knyttet til denne tolkebestillingen."
                            >
                            </lightning-helptext>
                        </h2>
                        <lightning-input
                            label="Bestillers navn"
                            name="ordererName"
                            class="tolk-skjema-input"
                            value={personAccount.Name}
                            disabled
                        >
                        </lightning-input>
                        <br />
                        <lightning-input-field
                            field-name="OrdererEmail__c"
                            class="tolk-skjema-input"
                            value={ordererDetails.OrdererEmail__c}
                            required
                        >
                        </lightning-input-field>
                        <br />
                        <lightning-input-field
                            field-name="OrdererPhone__c"
                            class="tolk-skjema-input"
                            value={ordererDetails.OrdererPhone__c}
                            required
                        >
                        </lightning-input-field>
                        <br />
                        <c-checkbox
                            label="Ønsker SMS-varsel ved statusendring på bestillingen"
                            oncheckboxclick={handleSMSCheckbox}
                        ></c-checkbox>
                    </section>

                    <section if:true={userForm} class="bruker-info-skjema sub-form">
                        <h2 style="font-size: 1.25rem">
                            Informasjon om tolkebruker
                            <lightning-helptext
                                content="Oppgi hvem som trenger tolk fra tolketjenesten for døve, døvblinde og hørselshemmede."
                            >
                            </lightning-helptext>
                        </h2>
                        <lightning-input-field
                            class="tolk-skjema-input"
                            field-name="UserName__c"
                            required
                            value={fieldValues.UserName__c}
                        >
                        </lightning-input-field>
                        <br />
                        <lightning-input
                            class="tolk-skjema-input personNumber"
                            label="Tolkbrukers fødselsnummer"
                            type="text"
                            max-length="11"
                            name="UserPersonNumber__c"
                            value={fieldValues.UserPersonNumber__c}
                            required
                            onblur={checkPersonNumber}
                        >
                        </lightning-input>
                    </section>

                    <section if:true={companyForm} class="virksomhet-info-skjema sub-form">
                        <h2 style="font-size: 1.25rem">Informasjon om virksomhet</h2>
                        <lightning-input-field
                            class="tolk-skjema-input"
                            field-name="OrganizationNumber__c"
                            value={fieldValues.OrganizationNumber__c}
                            required
                        >
                        </lightning-input-field>
                        <br />
                        <lightning-input-field
                            class="tolk-skjema-input"
                            field-name="InvoiceReference__c"
                            value={fieldValues.InvoiceReference__c}
                        >
                        </lightning-input-field>
                        <br />
                        <lightning-input-field
                            class="tolk-skjema-input"
                            field-name="AdditionalInvoiceText__c"
                            value={fieldValues.AdditionalInvoiceText__c}
                        >
                        </lightning-input-field>
                    </section>

                    <section if:true={requestForm} class="bestilling-info-skjema">
                        <h2 style="font-size: 1.25rem">Informasjon om behov for tolk</h2>
                        <lightning-input-field
                            class="tolk-skjema-input"
                            field-name="Subject__c"
                            value={fieldValues.Subject__c}
                            title="Hva trenger du tolk til?"
                            required
                        >
                        </lightning-input-field>
                        <br />

                        <div style="margin-bottom: 0.5rem">
                            <div class="time-inputs-container" style="margin-bottom: 0.5rem" aria-live>
                                <template iterator:it={times}>
                                    <div class="dynamic-time-inputs-with-line_button" key={it.value.id}>
                                        <div class="dynamic-time-inputs" aria-live>
                                            <lightning-input
                                                label="Dato (dd.mm.åååå)"
                                                type="date"
                                                class="tolk-skjema-input date"
                                                date-style="short"
                                                onchange={setDate}
                                                name={it.value.id}
                                                value={it.value.date}
                                                required
                                            >
                                            </lightning-input>
                                            <div class="dynamic-time-inputs__times">
                                                <lightning-input
                                                    label="Fra (tt:mm)"
                                                    type="time"
                                                    class="tolk-skjema-input start-tid"
                                                    onchange={setStartTime}
                                                    name={it.value.id}
                                                    value={it.value.startTime}
                                                    required
                                                >
                                                </lightning-input>
                                                <lightning-input
                                                    label="Til (tt:mm)"
                                                    type="time"
                                                    class="tolk-skjema-input slutt-tid"
                                                    onchange={setEndTime}
                                                    name={it.value.id}
                                                    value={it.value.endTime}
                                                    required
                                                >
                                                </lightning-input>
                                            </div>
                                        </div>
                                        <lightning-button
                                            if:false={isOnlyOneTime}
                                            variant="base"
                                            icon-name="utility:close"
                                            class="remove-time__button"
                                            onclick={removeTime}
                                            name={it.value.id}
                                            aria-label="Fjern tid"
                                        >
                                        </lightning-button>
                                    </div>
                                </template>
                            </div>

                            <lightning-input
                                if:false={isEditMode}
                                type="checkbox"
                                class="filter-list-checkbox"
                                label="Gjentagende"
                                name="Gjentagende"
                                onchange={advancedTimes}
                            >
                            </lightning-input>

                            <div
                                if:true={isAdvancedTimes}
                                class="time-inputs-container"
                                style="margin-bottom: 0.5rem"
                                aria-live
                            >
                                <lightning-combobox
                                    name="Gjenta"
                                    variant="label-hidden"
                                    options={repeatingOptions}
                                    value={repeatingOptionChosen}
                                    onchange={handleRepeatChoiceMade}
                                    class="tolk-skjema-input third-width recurringType"
                                    label="Gjenta"
                                >
                                </lightning-combobox>
                                <div if:true={showWeekDays} aria-live>
                                    <lightning-checkbox-group
                                        label="Ukedager"
                                        name="Days"
                                        options={days}
                                        value={chosenDays}
                                        class="recurringDays"
                                        onchange={handleDayChosen}
                                    >
                                    </lightning-checkbox-group>
                                </div>
                                <div aria-live if:true={isRepeating}>
                                    <lightning-input
                                        label="Slutt dato"
                                        type="date"
                                        name="recurring End Date"
                                        class="tolk-skjema-input third-width recurringEndDate"
                                        date-style="short"
                                        value={repeatingEndDate}
                                        onchange={setRepeatingEndDateDate}
                                        required
                                    >
                                    </lightning-input>
                                </div>
                            </div>

                            <lightning-button
                                if:false={isAdvancedTimes}
                                label="Legg til flere tider"
                                icon-name="utility:add"
                                class="add-times"
                                onclick={addTime}
                            >
                            </lightning-button>
                        </div>

                        <br />
                        <lightning-input-field
                            class="tolk-skjema-input adressefelt-hjelp"
                            field-name="MeetingStreet__c"
                            value={fieldValues.MeetingStreet__c}
                            required
                        >
                        </lightning-input-field>
                        <div class="slds-grid slds-gutters">
                            <div class="slds-col slds-size_2-of-5">
                                <lightning-input-field
                                    class="tolk-skjema-input postnummer"
                                    title="Postnummer"
                                    field-name="MeetingPostalCode__c"
                                    value={fieldValues.MeetingPostalCode__c}
                                >
                                </lightning-input-field>
                            </div>
                            <div class="slds-col slds-size_3-of-5">
                                <lightning-input-field
                                    class="tolk-skjema-input"
                                    title="Poststed"
                                    field-name="MeetingPostalCity__c"
                                    value={fieldValues.MeetingPostalCity__c}
                                >
                                </lightning-input-field>
                            </div>
                        </div>
                        <br />

                        <lightning-radio-group
                            class="nav-radio-button-group horizontal radio-button-group_yes-no"
                            name="radioGroup"
                            label="Er oppmøteadresse det samme som tolkeadresse?"
                            options={options}
                            value={value}
                            type="radio"
                            onchange={toggled}
                        ></lightning-radio-group>

                        <div if:false={sameLocation}>
                            <lightning-input-field
                                class="tolk-skjema-input adressefelt-hjelp"
                                title="Tolkeaddresse"
                                field-name="InterpretationStreet__c"
                                value={fieldValues.InterpretationStreet__c}
                            >
                            </lightning-input-field>
                            <div class="slds-grid slds-gutters">
                                <div class="slds-col slds-size_2-of-5">
                                    <lightning-input-field
                                        class="tolk-skjema-input postnummer"
                                        title="Postnummer"
                                        field-name="InterpretationPostalCode__c"
                                        value={fieldValues.InterpretationPostalCode__c}
                                    >
                                    </lightning-input-field>
                                </div>
                                <div class="slds-col slds-size_3-of-5">
                                    <lightning-input-field
                                        class="tolk-skjema-input"
                                        title="Poststed"
                                        field-name="InterpretationPostalCity__c"
                                        value={fieldValues.InterpretationPostalCity__c}
                                    >
                                    </lightning-input-field>
                                </div>
                            </div>
                        </div>
                        <br />
                        <lightning-input-field
                            class="tolk-skjema-input ikke-sensitiv-fritekst"
                            title="Tilleggsopplysninger"
                            field-name="Description__c"
                            value={fieldValues.Description__c}
                        >
                        </lightning-input-field>
                        <div style="margin-left: none">
                            <c-upload-files
                                record-id={recordId}
                                onfiledatalength={checkFileDataLength}
                                ongetcheckboxvalue={getCheckboxValue}
                                desktop-style="margin-left: unset"
                                checkbox-validation="true"
                                checkbox-text-plural="Dokumentene som er lagt ved gir mer informasjon om denne bestillingen. Jeg er klar over at vedlegget vil bli delt med tolken(e) jeg får."
                                checkbox-text-single="Dokumentet som er lagt ved gir mer informasjon om denne bestillingen. Jeg er klar over at vedlegget vil bli delt med tolken(e) jeg får."
                                validation-message="For å legge til vedlegg må du gi samtykke til at formidler og tolk kan se vedleggene som lastes opp"
                            ></c-upload-files>
                        </div>
                        <br />
                        <c-record-files-with-sharing
                            record-id={recordId}
                            is-get-all={isGetAll}
                            is-delete-option="true"
                            title="Tidligere opplastede vedlegg"
                        ></c-record-files-with-sharing>

                        <lightning-messages aria-live="assertive"> </lightning-messages>

                        <div class="button-container">
                            <div style="display: flex; justify-content: center">
                                <div if:true={spin} class="loader"></div>
                            </div>
                            <div if:false={spin}>
                                <lightning-button
                                    title="Send inn bestilling"
                                    class="slds-m-left_x-small"
                                    type="submit"
                                    variant="brand"
                                    label="SEND INN"
                                >
                                </lightning-button>
                                <br />
                                <lightning-button
                                    title="Avbryt"
                                    variant="base"
                                    label="Avbryt"
                                    onclick={goToPrevousPage}
                                    class="slds-m-left_x-small back-button"
                                >
                                </lightning-button>
                            </div>
                        </div>
                    </section>
                </div>
            </lightning-record-edit-form>
        </div>
    </div>

    <div class="main-content hidden submitted-true">
        <div class="main-content dialog-boks skjema-max-width">
            <lightning-icon
                icon-name="utility:success"
                alternative-text="Suksess"
                title="Suksess"
                variant="success"
                size="large"
            >
            </lightning-icon>
            <br />
            <h2 class="typo-undertittel h2-successMessage" id="successMessage" tabindex="-1">Bestilling mottatt</h2>
            <br />
            <lightning-button title="Gå til mine bestillinger" variant="brand" label="OK" onclick={goToMyRequests}>
            </lightning-button>
        </div>
    </div>

    <c-alertdialog
        header="Noe gikk galt"
        content={modalContent}
        desktop-style="text-align: center;"
        center-buttons="true"
        no-cancel-button="true"
    >
    </c-alertdialog>
</template>
